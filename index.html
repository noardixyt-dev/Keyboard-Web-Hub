<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>AULA | Rhythm Dreamer</title>
    <style>
        :root {
            --bg: #1a1a2e;
            --glass: rgba(255, 255, 255, 0.07);
            --call: #ff7eb9;
            --resp: #7afcff;
        }

        body {
            margin: 0; padding: 0; height: 100vh;
            background: radial-gradient(circle at center, #2e1a47 0%, #10101a 100%);
            display: flex; align-items: center; justify-content: center;
            font-family: 'Inter', sans-serif; color: white; overflow: hidden;
        }

        .glass-ui {
            background: var(--glass);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 40px;
            padding: 60px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
            width: 550px;
        }

        .beat-container {
            display: flex; justify-content: center; gap: 20px; margin: 40px 0;
        }

        .dot {
            width: 50px; height: 50px; border-radius: 50%;
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.1s ease;
            position: relative;
        }

        .dot.active { transform: scale(1.2); border-color: rgba(255,255,255,0.5); }
        .dot.call-hit { background: var(--call); box-shadow: 0 0 30px var(--call); border: none; }
        .dot.player-hit { background: var(--resp); box-shadow: 0 0 30px var(--resp); border: none; }

        .phase-text {
            font-size: 28px; font-weight: 200; letter-spacing: 8px;
            text-transform: uppercase; height: 40px; margin-bottom: 10px;
        }

        #start-btn {
            background: white; color: black; border: none;
            padding: 18px 45px; border-radius: 50px; font-weight: bold;
            cursor: pointer; font-size: 16px; transition: 0.3s;
        }

        #start-btn:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--resp); }
        
        .instructions { font-size: 12px; opacity: 0.4; margin-top: 30px; letter-spacing: 1px; }
    </style>
</head>
<body>

<div class="glass-ui">
    <div class="phase-text" id="phase-display">Rhythm Dream</div>
    <div class="beat-container" id="visualizer">
        <div class="dot" id="d0"></div>
        <div class="dot" id="d1"></div>
        <div class="dot" id="d2"></div>
        <div class="dot" id="d3"></div>
    </div>
    <button id="start-btn">TRAUM STARTEN</button>
    <div id="feedback" style="margin-top: 20px; font-weight: bold; color: var(--resp);"></div>
    <div class="instructions">HÃ–R ZU (PINK) â†’ REAGIERE (BLAU) MIT LEERTASTE</div>
</div>

<script>
    // Audio Engine Setup
    const AudioCtx = window.AudioContext || window.webkitAudioContext;
    let audioCtx;
    let isPlaying = false;
    let currentBeat = 0;
    let phase = 'call';
    let pattern = [true, false, true, true];
    let userInputs = [false, false, false, false];
    let interval;

    const startBtn = document.getElementById('start-btn');
    const phaseDisplay = document.getElementById('phase-display');
    const dots = [document.getElementById('d0'), document.getElementById('d1'), document.getElementById('d2'), document.getElementById('d3')];

    function createOscillator(freq, type, duration, vol = 0.1) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    // Die Musik / Der Metronom-Beat
    function playKick() { createOscillator(60, 'sine', 0.2, 0.3); } // Kick Drum
    function playSnap() { createOscillator(800, 'square', 0.05, 0.05); } // Metronom-Klick

    function startLoop() {
        const bpm = 600; // Tempo
        interval = setInterval(() => {
            dots.forEach(d => { d.classList.remove('active'); d.classList.remove('call-hit'); d.classList.remove('player-hit'); });
            
            // Metronom immer spielen
            playSnap();
            dots[currentBeat].classList.add('active');

            if (phase === 'call') {
                if (pattern[currentBeat]) {
                    dots[currentBeat].classList.add('call-hit');
                    createOscillator(440, 'triangle', 0.3, 0.2); // Melodie Call
                }
            } else {
                // Spieler-Phase
                if (userInputs[currentBeat]) {
                    dots[currentBeat].classList.add('player-hit');
                }
            }

            currentBeat++;
            if (currentBeat > 3) {
                currentBeat = 0;
                togglePhase();
            }
        }, bpm);
    }

    function togglePhase() {
        if (phase === 'call') {
            phase = 'response';
            phaseDisplay.innerText = "DEIN ECHO";
            phaseDisplay.style.color = "var(--resp)";
            userInputs = [false, false, false, false];
        } else {
            checkResult();
            phase = 'call';
            phaseDisplay.innerText = "HÃ–R ZU";
            phaseDisplay.style.color = "var(--call)";
            pattern = Array.from({length: 4}, () => Math.random() > 0.5);
            if (pattern.every(b => !b)) pattern[0] = true; // Mindestens ein Hit
        }
    }

    function checkResult() {
        const correct = JSON.stringify(pattern) === JSON.stringify(userInputs);
        const fb = document.getElementById('feedback');
        if (correct) {
            fb.innerText = "PERFEKT âœ¨";
            createOscillator(880, 'sine', 0.5, 0.1); // Erfolgssound
        } else {
            fb.innerText = "AUS DEM TAKT... ðŸŒ™";
        }
        setTimeout(() => fb.innerText = "", 1500);
    }

    window.addEventListener('keydown', (e) => {
        if (e.code === 'Space' && phase === 'response') {
            e.preventDefault();
            userInputs[currentBeat] = true;
            createOscillator(330, 'triangle', 0.2, 0.2); // Spieler-Sound
            dots[currentBeat].classList.add('player-hit');
        }
    });

    startBtn.onclick = () => {
        if (!audioCtx) audioCtx = new AudioCtx();
        if (isPlaying) return;
        isPlaying = true;
        startBtn.style.opacity = '0';
        setTimeout(() => startBtn.style.display = 'none', 300);
        startLoop();
    };
</script>
</body>
</html>
